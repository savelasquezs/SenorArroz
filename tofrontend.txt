# üìã ESPECIFICACIONES PARA FRONTEND - Sistema Se√±or Arroz

## üéØ CONTEXTO GENERAL DEL SISTEMA

### Roles y Permisos
- **Superadmin**: Acceso total al sistema, todas las sucursales
- **Admin**: Gesti√≥n completa de su sucursal (productos, usuarios, pedidos, bancos, apps)
- **Cashier**: Crear/modificar pedidos, clientes, asignar domiciliarios, cuadre de caja
- **Kitchen**: Ver pedidos en preparaci√≥n, cambiar a estado 'Ready'
- **Deliveryman**: Ver pedidos 'Ready', autoasignarse, entregar pedidos

### Reglas de Negocio Importantes
- Solo 1 superadmin en el sistema, 1 admin/cocina por sucursal
- Pedidos delivery requieren cliente y direcci√≥n obligatoria
- Pedidos onsite pueden no tener cliente (solo nombre de referencia)
- Pedidos reserva requieren fecha/hora de entrega obligatoria
- Cancelaci√≥n requiere motivo y no suma puntos de fidelizaci√≥n
- Solo 1 App Payment por pedido, m√∫ltiples Bank Payments permitidos
- Los subtotales y totales se calculan autom√°ticamente en la BD

---

## üõí M√ìDULO DE PEDIDOS - IMPLEMENTACI√ìN PRIORITARIA

### üìç Base URL: `/api/orders`

### üéØ FUNCIONALIDAD PRINCIPAL: CREACI√ìN DE PEDIDOS

#### **POST** `/api/orders` - Crear nuevo pedido
**Descripci√≥n**: Crea un pedido completo con productos y m√©todos de pago
**Autorizaci√≥n**: admin, superadmin, cashier
**Par√°metros de entrada** (Body):

```json
{
  "branchId": 1,                           // Solo superadmin especifica
  "takenById": 2,                          // ID del usuario que toma el pedido
  "customerId": 3,                         // Opcional para onsite, obligatorio para delivery
  "addressId": 4,                          // Obligatorio para delivery
  "loyaltyRuleId": 5,                      // Opcional - regla de fidelizaci√≥n
  "type": "delivery",                      // "onsite", "delivery", "reservation"
  "deliveryFee": 5000,                     // Opcional - se toma de la direcci√≥n por defecto
  "reservedFor": "2024-01-15T19:00:00Z",   // Obligatorio para reservation
  "subtotal": 50000,                       // Se calcula autom√°ticamente en BD
  "total": 55000,                          // Se calcula autom√°ticamente en BD
  "discountTotal": 0,                      // Se calcula autom√°ticamente en BD
  "notes": "Sin cebolla",                  // Opcional
  "orderDetails": [                        // Array de productos
    {
      "productId": 1,
      "quantity": 2,
      "unitPrice": 25000,
      "discount": 0,
      "notes": "Sin picante"               // Opcional
    },
    {
      "productId": 5,
      "quantity": 1,
      "unitPrice": 15000,
      "discount": 1000,
      "notes": "Extra queso"
    }
  ],
  "bankPayments": [                        // Array de pagos bancarios (m√∫ltiples permitidos)
    {
      "bankId": 1,
      "amount": 30000
    },
    {
      "bankId": 2,
      "amount": 15000
    }
  ],
  "appPayments": [                         // Array de pagos de apps (m√°ximo 1 por pedido)
    {
      "appId": 1,
      "amount": 10000
    }
  ]
}
```

**Respuesta exitosa** (201):
```json
{
  "id": 123,
  "branchId": 1,
  "branchName": "Sucursal Centro",
  "takenById": 2,
  "takenByName": "Juan P√©rez",
  "customerId": 3,
  "customerName": "Mar√≠a Garc√≠a",
  "customerPhone": "3001234567",
  "addressId": 4,
  "addressDescription": "Calle 123 #45-67",
  "loyaltyRuleId": 5,
  "loyaltyRuleName": "Cliente frecuente",
  "deliveryManId": null,
  "deliveryManName": null,
  "type": "delivery",
  "typeDisplayName": "Domicilio",
  "deliveryFee": 5000,
  "reservedFor": null,
  "status": "taken",
  "statusDisplayName": "Tomado",
  "subtotal": 50000,
  "total": 55000,
  "discountTotal": 1000,
  "notes": "Sin cebolla",
  "cancelledReason": null,
  "statusTimes": {
    "taken": "2024-01-01T10:00:00Z"
  },
  "createdAt": "2024-01-01T10:00:00Z",
  "updatedAt": "2024-01-01T10:00:00Z"
}
```

### üé® ESPECIFICACIONES DE INTERFAZ - CREACI√ìN DE PEDIDOS

#### **Estructura de la Interfaz**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üõí CREAR NUEVO PEDIDO                    [Guardar] [Cancelar]‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Tipo: [Onsite ‚ñº] Cliente: [Buscar por tel√©fono...]         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Direcci√≥n: [Seleccionar direcci√≥n...]                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üçï CATEGOR√çAS    ‚îÇ üçù PRODUCTOS                             ‚îÇ
‚îÇ ‚ñ° Pastas         ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ ‚ñ† Pizzas         ‚îÇ ‚îÇ üçï Pizza Margherita    $25,000     ‚îÇ   ‚îÇ
‚îÇ ‚ñ° Bebidas        ‚îÇ ‚îÇ [Agregar] [1] [-][+]                ‚îÇ   ‚îÇ
‚îÇ ‚ñ° Postres        ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üí∞ RESUMEN DEL PEDIDO                                       ‚îÇ
‚îÇ Subtotal: $50,000  Descuento: $1,000  Domicilio: $5,000    ‚îÇ
‚îÇ TOTAL: $54,000                                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üí≥ M√âTODOS DE PAGO                                          ‚îÇ
‚îÇ üè¶ Bancos: [Bancolombia ‚ñº] $30,000 [+ Agregar Banco]       ‚îÇ
‚îÇ üì± Apps: [Nequi ‚ñº] $10,000                                 ‚îÇ
‚îÇ üíµ Efectivo: $14,000 (calculado autom√°ticamente)           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üìù Notas: [Sin cebolla...]                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üéØ FUNCIONALIDADES POR TIPO DE PEDIDO

#### **ONSITE (En el Local)**
- ‚úÖ Cliente opcional
- ‚úÖ Campo "Nombre de referencia" (ej: "Mesa 5", "Persona que recoge")
- ‚úÖ Sin direcci√≥n
- ‚úÖ Sin domicilio
- ‚úÖ Productos y pagos normales

#### **DELIVERY (Domicilio)**
- ‚úÖ Cliente obligatorio
- ‚úÖ B√∫squeda por tel√©fono (crear si no existe)
- ‚úÖ Selecci√≥n de direcci√≥n (crear nueva desde selector)
- ‚úÖ Domicilio autom√°tico desde direcci√≥n (modificable)
- ‚úÖ Productos y pagos normales

#### **RESERVATION (Reserva)**
- ‚úÖ Igual que pedido normal
- ‚úÖ Campo fecha/hora obligatorio
- ‚úÖ Se contabiliza en fecha de entrega, no de creaci√≥n

### üí≥ GESTI√ìN DE PAGOS

#### **Validaciones de Pago:**
- ‚úÖ M√°ximo 1 App Payment por pedido
- ‚úÖ M√∫ltiples Bank Payments permitidos
- ‚úÖ El total debe coincidir con suma de todos los pagos
- ‚úÖ El exceso se considera efectivo autom√°ticamente

### üåê ENDPOINTS ADICIONALES PARA CREACI√ìN DE PEDIDOS

#### **GET** `/api/products` - Lista de productos
**Par√°metros** (Query):
```
categoryId?: number, branchId?: number, active?: boolean, 
page: number = 1, pageSize: number = 10
```

#### **GET** `/api/productcategories` - Categor√≠as de productos
**Par√°metros** (Query):
```
branchId?: number, active?: boolean, page: number = 1, pageSize: number = 10
```

#### **GET** `/api/customers` - Buscar clientes
**Par√°metros** (Query):
```
phone?: string, name?: string, page: number = 1, pageSize: number = 10
```

#### **GET** `/api/customers/{id}/addresses` - Direcciones del cliente
**Par√°metros** (Route):
```
id: number  // ID del cliente
```

#### **POST** `/api/customers` - Crear nuevo cliente
```json
{
  "name": "Mar√≠a Garc√≠a",
  "phone1": "3001234567",
  "phone2": "3007654321",
  "addresses": [
    {
      "addressText": "Calle 123 #45-67",
      "isPrimary": true,
      "deliveryFee": 5000
    }
  ]
}
```

#### **POST** `/api/addresses` - Crear nueva direcci√≥n
```json
{
  "customerId": 3,
  "addressText": "Calle 123 #45-67",
  "isPrimary": false,
  "deliveryFee": 5000
}
```

---

## üè¶ M√ìDULOS ADICIONALES - BANKS Y APPS

### üìç Base URL: `/api/banks`

### 1. **GET** `/api/banks` - Lista paginada de bancos
**Descripci√≥n**: Obtiene una lista paginada de bancos con filtros
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada** (Query):
```
branchId?: number          // Solo superadmin puede especificar
name?: string              // Filtro por nombre
active?: boolean           // Filtro por estado activo
page: number = 1           // P√°gina actual
pageSize: number = 10      // Elementos por p√°gina
sortBy: string = "name"    // Campo de ordenamiento
sortOrder: string = "asc"  // Orden (asc/desc)
```

**Respuesta exitosa** (200):
```json
{
  "items": [
    {
      "id": 1,
      "branchId": 1,
      "branchName": "Sucursal Centro",
      "name": "Bancolombia",
      "imageUrl": "https://example.com/logo.png",
      "active": true,
      "createdAt": "2024-01-01T10:00:00Z",
      "updatedAt": "2024-01-01T10:00:00Z",
      "totalApps": 5,
      "activeApps": 4,
      "currentBalance": 1500000.00
    }
  ],
  "totalCount": 10,
  "page": 1,
  "pageSize": 10,
  "totalPages": 1
}
```

### 2. **GET** `/api/banks/{id}` - Obtener banco por ID
**Descripci√≥n**: Obtiene un banco espec√≠fico con estad√≠sticas b√°sicas
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada** (Route):
```
id: number                 // ID del banco
```

**Respuesta exitosa** (200):
```json
{
  "id": 1,
  "branchId": 1,
  "branchName": "Sucursal Centro",
  "name": "Bancolombia",
  "imageUrl": "https://example.com/logo.png",
  "active": true,
  "createdAt": "2024-01-01T10:00:00Z",
  "updatedAt": "2024-01-01T10:00:00Z",
  "totalApps": 5,
  "activeApps": 4,
  "currentBalance": 1500000.00
}
```

### 3. **GET** `/api/banks/{id}/detail` - Vista detallada del banco
**Descripci√≥n**: Obtiene informaci√≥n detallada del banco con estad√≠sticas completas
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada** (Route):
```
id: number                 // ID del banco
```

**Respuesta exitosa** (200):
```json
{
  "id": 1,
  "branchId": 1,
  "branchName": "Sucursal Centro",
  "name": "Bancolombia",
  "imageUrl": "https://example.com/logo.png",
  "active": true,
  "createdAt": "2024-01-01T10:00:00Z",
  "updatedAt": "2024-01-01T10:00:00Z",
  "totalApps": 5,
  "activeApps": 4,
  "totalBankPayments": 2500000.00,
  "totalExpenseBankPayments": 500000.00,
  "currentBalance": 1500000.00
}
```

### 4. **POST** `/api/banks` - Crear nuevo banco
**Descripci√≥n**: Crea un nuevo banco
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Body):
```json
{
  "branchId": 1,                    // Solo superadmin especifica
  "name": "Bancolombia",            // Requerido, m√°ximo 150 caracteres
  "imageUrl": "https://example.com/logo.png", // Opcional, m√°ximo 200 caracteres
  "active": true                    // Default: true
}
```

**Respuesta exitosa** (201):
```json
{
  "id": 1,
  "branchId": 1,
  "branchName": "Sucursal Centro",
  "name": "Bancolombia",
  "imageUrl": "https://example.com/logo.png",
  "active": true,
  "createdAt": "2024-01-01T10:00:00Z",
  "updatedAt": "2024-01-01T10:00:00Z",
  "totalApps": 0,
  "activeApps": 0,
  "currentBalance": 0.00
}
```

### 5. **PUT** `/api/banks/{id}` - Actualizar banco
**Descripci√≥n**: Actualiza un banco existente
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Route + Body):
```
id: number                 // ID del banco
```
```json
{
  "name": "Bancolombia Actualizado",
  "imageUrl": "https://example.com/new-logo.png",
  "active": true
}
```

**Respuesta exitosa** (200): Mismo formato que GET por ID

### 6. **DELETE** `/api/banks/{id}` - Eliminar banco
**Descripci√≥n**: Elimina un banco (soft delete)
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Route):
```
id: number                 // ID del banco
```

**Respuesta exitosa** (204): Sin contenido

---

## üì± APPS - Gesti√≥n de Aplicaciones

### üìç Base URL: `/api/apps`

### 1. **GET** `/api/apps` - Lista paginada de apps
**Descripci√≥n**: Obtiene una lista paginada de apps con filtros
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada** (Query):
```
bankId?: number            // Filtro por banco
name?: string              // Filtro por nombre
branchId?: number          // Solo superadmin puede especificar
active?: boolean           // Filtro por estado activo
page: number = 1           // P√°gina actual
pageSize: number = 10      // Elementos por p√°gina
sortBy: string = "name"    // Campo de ordenamiento
sortOrder: string = "asc"  // Orden (asc/desc)
```

**Respuesta exitosa** (200):
```json
{
  "items": [
    {
      "id": 1,
      "bankId": 1,
      "bankName": "Bancolombia",
      "branchId": 1,
      "branchName": "Sucursal Centro",
      "name": "Nequi",
      "imageUrl": "https://example.com/nequi-logo.png",
      "active": true,
      "createdAt": "2024-01-01T10:00:00Z",
      "updatedAt": "2024-01-01T10:00:00Z",
      "totalPayments": 500000.00,
      "unsettledPayments": 100000.00,
      "totalPaymentsCount": 25,
      "unsettledPaymentsCount": 5
    }
  ],
  "totalCount": 10,
  "page": 1,
  "pageSize": 10,
  "totalPages": 1
}
```

### 2. **GET** `/api/apps/{id}` - Obtener app por ID
**Descripci√≥n**: Obtiene una app espec√≠fica con estad√≠sticas
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada** (Route):
```
id: number                 // ID de la app
```

**Respuesta exitosa** (200): Mismo formato que item del listado

### 3. **GET** `/api/apps/by-bank/{bankId}` - Apps por banco
**Descripci√≥n**: Obtiene todas las apps de un banco espec√≠fico
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada** (Route):
```
bankId: number             // ID del banco
```

**Respuesta exitosa** (200):
```json
[
  {
    "id": 1,
    "bankId": 1,
    "bankName": "Bancolombia",
    "branchId": 1,
    "branchName": "Sucursal Centro",
    "name": "Nequi",
    "imageUrl": "https://example.com/nequi-logo.png",
    "active": true,
    "createdAt": "2024-01-01T10:00:00Z",
    "updatedAt": "2024-01-01T10:00:00Z",
    "totalPayments": 500000.00,
    "unsettledPayments": 100000.00,
    "totalPaymentsCount": 25,
    "unsettledPaymentsCount": 5
  }
]
```

### 4. **POST** `/api/apps` - Crear nueva app
**Descripci√≥n**: Crea una nueva app
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Body):
```json
{
  "bankId": 1,                        // Requerido
  "name": "Nequi",                    // Requerido, m√°ximo 150 caracteres
  "imageUrl": "https://example.com/nequi-logo.png", // Opcional, m√°ximo 200 caracteres
  "active": true                      // Default: true
}
```

**Respuesta exitosa** (201): Mismo formato que GET por ID

### 5. **PUT** `/api/apps/{id}` - Actualizar app
**Descripci√≥n**: Actualiza una app existente
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Route + Body):
```
id: number                 // ID de la app
```
```json
{
  "bankId": 1,
  "name": "Nequi Actualizado",
  "imageUrl": "https://example.com/new-nequi-logo.png",
  "active": true
}
```

**Respuesta exitosa** (200): Mismo formato que GET por ID

### 6. **DELETE** `/api/apps/{id}` - Eliminar app
**Descripci√≥n**: Elimina una app (soft delete)
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Route):
```
id: number                 // ID de la app
```

**Respuesta exitosa** (204): Sin contenido

---

## üí∞ BANK PAYMENTS - Gesti√≥n de Pagos Bancarios

### üìç Base URL: `/api/bankpayments`

### 1. **GET** `/api/bankpayments` - Lista paginada de pagos bancarios
**Descripci√≥n**: Obtiene una lista paginada de pagos bancarios con filtros
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada** (Query):
```
orderId?: number           // Filtro por orden
bankId?: number            // Filtro por banco
branchId?: number          // Solo superadmin puede especificar
verified?: boolean         // Filtro por estado de verificaci√≥n
fromDate?: string          // Filtro desde fecha (ISO 8601)
toDate?: string            // Filtro hasta fecha (ISO 8601)
page: number = 1           // P√°gina actual
pageSize: number = 10      // Elementos por p√°gina
sortBy: string = "createdAt" // Campo de ordenamiento
sortOrder: string = "desc"   // Orden (asc/desc)
```

**Respuesta exitosa** (200):
```json
{
  "items": [
    {
      "id": 1,
      "orderId": 123,
      "bankId": 1,
      "bankName": "Bancolombia",
      "branchId": 1,
      "branchName": "Sucursal Centro",
      "amount": 50000.00,
      "verifiedAt": "2024-01-01T15:30:00Z",
      "isVerified": true,
      "createdAt": "2024-01-01T10:00:00Z",
      "updatedAt": "2024-01-01T15:30:00Z"
    }
  ],
  "totalCount": 10,
  "page": 1,
  "pageSize": 10,
  "totalPages": 1
}
```

### 2. **GET** `/api/bankpayments/{id}` - Obtener pago bancario por ID
**Descripci√≥n**: Obtiene un pago bancario espec√≠fico
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada** (Route):
```
id: number                 // ID del pago bancario
```

**Respuesta exitosa** (200): Mismo formato que item del listado

### 3. **GET** `/api/bankpayments/unverified` - Pagos no verificados
**Descripci√≥n**: Obtiene todos los pagos bancarios no verificados
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada**: Ninguno

**Respuesta exitosa** (200): Array de pagos bancarios (mismo formato que items del listado)

### 4. **POST** `/api/bankpayments` - Crear pago bancario
**Descripci√≥n**: Crea un nuevo pago bancario (generalmente autom√°tico)
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Body):
```json
{
  "orderId": 123,                    // Requerido
  "bankId": 1,                       // Requerido
  "amount": 50000.00                 // Requerido, mayor a 0
}
```

**Respuesta exitosa** (201): Mismo formato que GET por ID

### 5. **POST** `/api/bankpayments/{id}/verify` - Verificar pago bancario
**Descripci√≥n**: Marca un pago bancario como verificado
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Route + Body):
```
id: number                 // ID del pago bancario
```
```json
{
  "verifiedAt": "2024-01-01T15:30:00Z" // Opcional, default: fecha actual
}
```

**Respuesta exitosa** (200):
```json
{
  "message": "Pago bancario verificado exitosamente"
}
```

### 6. **POST** `/api/bankpayments/{id}/unverify` - Desverificar pago bancario
**Descripci√≥n**: Marca un pago bancario como no verificado
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Route):
```
id: number                 // ID del pago bancario
```

**Respuesta exitosa** (200):
```json
{
  "message": "Pago bancario desverificado exitosamente"
}
```

### 7. **DELETE** `/api/bankpayments/{id}` - Eliminar pago bancario
**Descripci√≥n**: Elimina un pago bancario
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Route):
```
id: number                 // ID del pago bancario
```

**Respuesta exitosa** (204): Sin contenido

---

## üí≥ APP PAYMENTS - Gesti√≥n de Pagos de Apps

### üìç Base URL: `/api/apppayments`

### ‚ö†Ô∏è IMPORTANTE: CREACI√ìN Y MODIFICACI√ìN
- **Crear/Actualizar**: Solo desde toma de pedidos o modificaci√≥n de pedidos
- **Ver/Filtrar/Setear**: Disponible desde vista de gesti√≥n

### 1. **GET** `/api/apppayments` - Lista paginada de pagos de apps
**Descripci√≥n**: Obtiene una lista paginada de pagos de apps con filtros
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada** (Query):
```
orderId?: number           // Filtro por orden
appId?: number             // Filtro por app
bankId?: number            // Filtro por banco
branchId?: number          // Solo superadmin puede especificar
settled?: boolean          // Filtro por estado de liquidaci√≥n
fromDate?: string          // Filtro desde fecha (ISO 8601)
toDate?: string            // Filtro hasta fecha (ISO 8601)
page: number = 1           // P√°gina actual
pageSize: number = 10      // Elementos por p√°gina
sortBy: string = "createdAt" // Campo de ordenamiento
sortOrder: string = "desc"   // Orden (asc/desc)
```

**Respuesta exitosa** (200):
```json
{
  "items": [
    {
      "id": 1,
      "orderId": 123,
      "appId": 1,
      "appName": "Nequi",
      "bankId": 1,
      "bankName": "Bancolombia",
      "branchId": 1,
      "branchName": "Sucursal Centro",
      "amount": 50000.00,
      "isSetted": false,
      "createdAt": "2024-01-01T10:00:00Z",
      "updatedAt": "2024-01-01T10:00:00Z"
    }
  ],
  "totalCount": 10,
  "page": 1,
  "pageSize": 10,
  "totalPages": 1
}
```

### 2. **GET** `/api/apppayments/{id}` - Obtener pago de app por ID
**Descripci√≥n**: Obtiene un pago de app espec√≠fico
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada** (Route):
```
id: number                 // ID del pago de app
```

**Respuesta exitosa** (200): Mismo formato que item del listado

### 3. **GET** `/api/apppayments/unsettled` - Pagos no liquidados
**Descripci√≥n**: Obtiene todos los pagos de apps no liquidados
**Autorizaci√≥n**: Todos los usuarios autenticados
**Par√°metros de entrada** (Query):
```
appId?: number             // Filtro por app
fromDate?: string          // Filtro desde fecha (ISO 8601)
toDate?: string            // Filtro hasta fecha (ISO 8601)
page: number = 1           // P√°gina actual
pageSize: number = 10      // Elementos por p√°gina
```

**Respuesta exitosa** (200): Array de pagos de apps (mismo formato que items del listado)

### 4. **POST** `/api/apppayments` - Crear pago de app
**Descripci√≥n**: Crea un nuevo pago de app (SOLO desde toma de pedidos)
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Body):
```json
{
  "orderId": 123,                    // Requerido
  "appId": 1,                        // Requerido
  "amount": 50000.00                 // Requerido, mayor a 0
}
```

**Respuesta exitosa** (201): Mismo formato que GET por ID

### 5. **POST** `/api/apppayments/{id}/settle` - Liquidar pago individual
**Descripci√≥n**: Liquida un pago de app individual (marca como settled y crea bank payment)
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Route):
```
id: number                 // ID del pago de app
```

**Respuesta exitosa** (200):
```json
{
  "message": "Pago de app liquidado exitosamente. Se cre√≥ el bank payment correspondiente."
}
```

### 6. **POST** `/api/apppayments/settle-multiple` - Liquidar m√∫ltiples pagos
**Descripci√≥n**: Liquida m√∫ltiples pagos de apps (marca como settled y crea UN SOLO bank payment)
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Body):
```json
{
  "paymentIds": [1, 2, 3, 4, 5]     // Array de IDs de pagos a liquidar
}
```

**Respuesta exitosa** (200):
```json
{
  "message": "Pagos de apps liquidados exitosamente. Se cre√≥ un bank payment con el total."
}
```

### 7. **POST** `/api/apppayments/{id}/unsettle` - Desliquidar pago
**Descripci√≥n**: Desliquida un pago de app (marca como unsettled y elimina bank payment)
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Route):
```
id: number                 // ID del pago de app
```

**Respuesta exitosa** (200):
```json
{
  "message": "Pago de app desliquidado exitosamente. Se elimin√≥ el bank payment correspondiente."
}
```

### 8. **DELETE** `/api/apppayments/{id}` - Eliminar pago de app
**Descripci√≥n**: Elimina un pago de app
**Autorizaci√≥n**: admin, superadmin
**Par√°metros de entrada** (Route):
```
id: number                 // ID del pago de app
```

**Respuesta exitosa** (204): Sin contenido

---

## üéØ ESPECIFICACIONES DE IMPLEMENTACI√ìN FRONTEND

### üìç Vista de Detalle de Sucursal
La gesti√≥n completa de **Banks** y **Apps** se debe integrar en la vista de detalle de sucursal:

#### Secci√≥n de Bancos:
- Lista de bancos de la sucursal
- Botones: Crear, Editar, Eliminar, Ver Detalle
- Filtros: Nombre, Estado activo
- Estad√≠sticas: Total apps, apps activas, balance actual

#### Secci√≥n de Apps:
- Lista de apps por banco
- Botones: Crear, Editar, Eliminar
- Filtros: Banco, Nombre, Estado activo
- Estad√≠sticas: Total pagos, pagos no liquidados

### üìç Gesti√≥n de AppPayments

#### Restricciones de Creaci√≥n/Modificaci√≥n:
- **NO** incluir botones de "Crear" o "Editar" en la interfaz de gesti√≥n
- **S√ç** incluir vista de solo lectura con filtros avanzados
- **S√ç** incluir funcionalidad de liquidaci√≥n (setear)

#### Funcionalidad de Liquidaci√≥n Din√°mica:
```javascript
// L√≥gica para determinar endpoint seg√∫n cantidad de registros seleccionados
const selectedPayments = getSelectedAppPayments(); // Array de IDs

if (selectedPayments.length === 1) {
    // Usar endpoint individual
    await fetch(`/api/apppayments/${selectedPayments[0]}/settle`, {
        method: 'POST'
    });
} else if (selectedPayments.length > 1) {
    // Usar endpoint m√∫ltiple
    await fetch('/api/apppayments/settle-multiple', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ paymentIds: selectedPayments })
    });
}
```

#### Interfaz de Liquidaci√≥n:
- Checkbox para selecci√≥n m√∫ltiple
- Bot√≥n "Liquidar Seleccionados" (din√°mico seg√∫n cantidad)
- Bot√≥n "Desliquidar" para pagos ya liquidados
- Confirmaci√≥n antes de liquidar con resumen de montos

### üìç Gesti√≥n de BankPayments

#### Funcionalidad de Verificaci√≥n:
- Lista de pagos bancarios con estado de verificaci√≥n
- Botones "Verificar" y "Desverificar"
- Filtro especial para "Pagos No Verificados"
- Indicador visual del estado de verificaci√≥n

#### Flujo de Trabajo:
1. AppPayment se liquida ‚Üí BankPayment se crea autom√°ticamente
2. BankPayment aparece en lista de "No Verificados"
3. Usuario verifica el BankPayment
4. Se actualiza el estado y timestamp de verificaci√≥n

---

## üîê AUTORIZACI√ìN Y PERMISOS

### Roles y Acceso:
- **superadmin**: Acceso completo a todas las sucursales
- **admin**: Solo acceso a su sucursal
- **cashier**: Solo lectura de datos de su sucursal
- **kitchen**: Sin acceso a estos m√≥dulos
- **deliveryman**: Sin acceso a estos m√≥dulos

### Endpoints por Rol:
- **Crear/Editar/Eliminar**: admin, superadmin
- **Ver/Listar/Filtrar**: Todos los usuarios autenticados
- **Liquidar/Verificar**: admin, superadmin

---

## üìä C√ìDIGOS DE RESPUESTA HTTP

### √âxito:
- **200**: OK - Operaci√≥n exitosa
- **201**: Created - Recurso creado exitosamente
- **204**: No Content - Eliminaci√≥n exitosa

### Error:
- **400**: Bad Request - Datos inv√°lidos
- **401**: Unauthorized - No autenticado
- **403**: Forbidden - Sin permisos
- **404**: Not Found - Recurso no encontrado
- **500**: Internal Server Error - Error del servidor

---

## üîÑ FLUJO DE LIQUIDACI√ìN COMPLETO

### 1. Liquidaci√≥n Individual:
```
AppPayment (isSetted: false) 
    ‚Üì POST /api/apppayments/{id}/settle
AppPayment (isSetted: true) + BankPayment (creado autom√°ticamente)
```

### 2. Liquidaci√≥n M√∫ltiple:
```
AppPayment1 (isSetted: false) 
AppPayment2 (isSetted: false) 
AppPayment3 (isSetted: false)
    ‚Üì POST /api/apppayments/settle-multiple
AppPayment1 (isSetted: true)
AppPayment2 (isSetted: true) 
AppPayment3 (isSetted: true)
+ BankPayment (con suma total)
```

### 3. Verificaci√≥n:
```
BankPayment (verifiedAt: null)
    ‚Üì POST /api/bankpayments/{id}/verify
BankPayment (verifiedAt: timestamp)
```

### 4. Reversi√≥n:
```
AppPayment (isSetted: true) + BankPayment
    ‚Üì POST /api/apppayments/{id}/unsettle
AppPayment (isSetted: false) + BankPayment (eliminado)
```

---

## üìù NOTAS IMPORTANTES

1. **Consistencia de Tipos**: Todos los montos son `decimal` para precisi√≥n
2. **Soft Delete**: Las eliminaciones son l√≥gicas, no f√≠sicas
3. **Auditor√≠a**: Todos los cambios quedan registrados con timestamps
4. **Integridad**: No se pueden eliminar entidades con relaciones activas
5. **Filtrado Autom√°tico**: Los usuarios solo ven datos de su sucursal (excepto superadmin)
6. **Estad√≠sticas en Tiempo Real**: Se calculan din√°micamente en cada consulta

Este archivo proporciona toda la informaci√≥n necesaria para implementar la interfaz frontend completa de los m√≥dulos de gesti√≥n financiera del sistema.
