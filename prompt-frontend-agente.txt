# ğŸ¯ PROMPT PARA AGENTE DE FRONTEND - Sistema SeÃ±or Arroz

## ğŸ“‹ CONTEXTO DEL PROYECTO

Eres un desarrollador frontend especializado en React/Next.js y necesitas implementar el mÃ³dulo de creaciÃ³n de pedidos para el sistema de gestiÃ³n de restaurante "SeÃ±or Arroz".

### ğŸ—ï¸ ARQUITECTURA DEL SISTEMA
- **Backend**: .NET Core API con CQRS pattern
- **Base de datos**: PostgreSQL con Entity Framework Core
- **AutenticaciÃ³n**: JWT con roles (Superadmin, Admin, Cashier, Kitchen, Deliveryman)
- **PatrÃ³n**: Repository + MediatR + AutoMapper

### ğŸ¯ OBJETIVO PRINCIPAL
Implementar una interfaz completa para la **creaciÃ³n de pedidos** que permita a los usuarios (cajeros, administradores) crear pedidos de manera eficiente y rÃ¡pida.

---

## ğŸ›’ FUNCIONALIDADES A IMPLEMENTAR

### 1. **CREACIÃ“N DE PEDIDOS**
- âœ… Soporte para 3 tipos: Onsite, Delivery, Reservation
- âœ… GestiÃ³n de mÃºltiples pedidos en paralelo (tabs)
- âœ… Selector de productos por categorÃ­as
- âœ… Carrito de productos con cantidades y precios
- âœ… MÃºltiples mÃ©todos de pago (Bancos, Apps, Efectivo)
- âœ… GestiÃ³n de clientes y direcciones
- âœ… CÃ¡lculo automÃ¡tico de totales

### 2. **TIPOS DE PEDIDO**

#### **ONSITE (En el Local)**
- Cliente opcional
- Campo "Nombre de referencia" (ej: "Mesa 5")
- Sin direcciÃ³n ni domicilio

#### **DELIVERY (Domicilio)**
- Cliente obligatorio (bÃºsqueda por telÃ©fono)
- DirecciÃ³n obligatoria (seleccionar o crear nueva)
- Domicilio automÃ¡tico desde direcciÃ³n

#### **RESERVATION (Reserva)**
- Igual que pedido normal
- Fecha/hora de entrega obligatoria

### 3. **GESTIÃ“N DE PAGOS**
- MÃ¡ximo 1 App Payment por pedido
- MÃºltiples Bank Payments permitidos
- El exceso se considera efectivo automÃ¡ticamente
- ValidaciÃ³n de totales en tiempo real

---

## ğŸŒ ENDPOINTS DE LA API

### ğŸ“ Base URL: `/api/orders`

### **POST** `/api/orders` - Crear pedido
```json
{
  "branchId": 1,
  "takenById": 2,
  "customerId": 3,                    // Opcional para onsite
  "addressId": 4,                     // Obligatorio para delivery
  "loyaltyRuleId": 5,                 // Opcional
  "type": "delivery",                 // "onsite", "delivery", "reservation"
  "deliveryFee": 5000,                // Opcional
  "reservedFor": "2024-01-15T19:00:00Z", // Obligatorio para reservation
  "subtotal": 50000,                  // Calculado automÃ¡ticamente
  "total": 55000,                     // Calculado automÃ¡ticamente
  "discountTotal": 0,                 // Calculado automÃ¡ticamente
  "notes": "Sin cebolla",
  "orderDetails": [
    {
      "productId": 1,
      "quantity": 2,
      "unitPrice": 25000,
      "discount": 0,
      "notes": "Sin picante"
    }
  ],
  "bankPayments": [
    {
      "bankId": 1,
      "amount": 30000
    }
  ],
  "appPayments": [
    {
      "appId": 1,
      "amount": 10000
    }
  ]
}
```

### **GET** `/api/products` - Lista de productos
```
ParÃ¡metros: categoryId?, branchId?, active?, page, pageSize
```

### **GET** `/api/productcategories` - CategorÃ­as de productos
```
ParÃ¡metros: branchId?, active?, page, pageSize
```

### **GET** `/api/customers` - Buscar clientes
```
ParÃ¡metros: phone?, name?, page, pageSize
```

### **GET** `/api/banks` - Bancos disponibles
```
ParÃ¡metros: branchId?, active?, page, pageSize
```

### **GET** `/api/apps` - Apps disponibles
```
ParÃ¡metros: bankId?, branchId?, active?, page, pageSize
```

---

## ğŸ¨ ESPECIFICACIONES DE DISEÃ‘O

### ğŸ“± Estructura de la Interfaz

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›’ CREAR NUEVO PEDIDO                    [Guardar] [Cancelar]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tipo: [Onsite â–¼] Cliente: [Buscar por telÃ©fono...]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DirecciÃ³n: [Seleccionar direcciÃ³n...]                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ• CATEGORÃAS    â”‚ ğŸ PRODUCTOS                             â”‚
â”‚ â–¡ Pastas         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â–  Pizzas         â”‚ â”‚ ğŸ• Pizza Margherita    $25,000     â”‚   â”‚
â”‚ â–¡ Bebidas        â”‚ â”‚ [Agregar] [1] [-][+]                â”‚   â”‚
â”‚ â–¡ Postres        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’° RESUMEN DEL PEDIDO                                       â”‚
â”‚ Subtotal: $50,000  Descuento: $1,000  Domicilio: $5,000    â”‚
â”‚ TOTAL: $54,000                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’³ MÃ‰TODOS DE PAGO                                          â”‚
â”‚ ğŸ¦ Bancos: [Bancolombia â–¼] $30,000 [+ Agregar Banco]       â”‚
â”‚ ğŸ“± Apps: [Nequi â–¼] $10,000                                 â”‚
â”‚ ğŸ’µ Efectivo: $14,000 (calculado automÃ¡ticamente)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Notas: [Sin cebolla...]                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¨ Paleta de Colores
```css
:root {
  --primary: #2E7D32;        /* Verde principal */
  --secondary: #FF6F00;      /* Naranja secundario */
  --accent: #1976D2;         /* Azul para acciones */
  --success: #4CAF50;        /* Verde Ã©xito */
  --warning: #FF9800;        /* Naranja advertencia */
  --error: #F44336;          /* Rojo error */
  --background: #FAFAFA;     /* Fondo claro */
  --surface: #FFFFFF;        /* Superficie */
}
```

### ğŸ“± Componentes Necesarios

#### 1. **OrderForm** - Formulario principal
#### 2. **ProductSelector** - Selector de productos por categorÃ­as
#### 3. **CartItems** - Lista de productos en el carrito
#### 4. **PaymentSelector** - Selector de mÃ©todos de pago
#### 5. **CustomerSelector** - BÃºsqueda y selecciÃ³n de clientes
#### 6. **AddressSelector** - SelecciÃ³n de direcciones
#### 7. **OrderSummary** - Resumen de totales
#### 8. **MultiOrderTabs** - Tabs para mÃºltiples pedidos

---

## ğŸ”§ IMPLEMENTACIÃ“N TÃ‰CNICA

### ğŸ› ï¸ Stack TecnolÃ³gico Sugerido
- **Framework**: React 18 + TypeScript
- **Estado**: Zustand o Redux Toolkit
- **UI**: Material-UI o Chakra UI
- **Formularios**: React Hook Form + Zod
- **HTTP**: Axios o TanStack Query
- **Routing**: React Router v6

### ğŸ“¦ Estructura de Archivos
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ orders/
â”‚   â”‚   â”œâ”€â”€ OrderForm.tsx
â”‚   â”‚   â”œâ”€â”€ ProductSelector.tsx
â”‚   â”‚   â”œâ”€â”€ CartItems.tsx
â”‚   â”‚   â”œâ”€â”€ PaymentSelector.tsx
â”‚   â”‚   â”œâ”€â”€ CustomerSelector.tsx
â”‚   â”‚   â”œâ”€â”€ AddressSelector.tsx
â”‚   â”‚   â”œâ”€â”€ OrderSummary.tsx
â”‚   â”‚   â””â”€â”€ MultiOrderTabs.tsx
â”‚   â””â”€â”€ ui/
â”‚       â”œâ”€â”€ Button.tsx
â”‚       â”œâ”€â”€ Input.tsx
â”‚       â”œâ”€â”€ Select.tsx
â”‚       â””â”€â”€ Modal.tsx
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useOrders.ts
â”‚   â”œâ”€â”€ useProducts.ts
â”‚   â”œâ”€â”€ useCustomers.ts
â”‚   â””â”€â”€ usePayments.ts
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api.ts
â”‚   â”œâ”€â”€ orders.ts
â”‚   â”œâ”€â”€ products.ts
â”‚   â””â”€â”€ customers.ts
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ orderStore.ts
â”‚   â””â”€â”€ uiStore.ts
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ order.ts
â”‚   â”œâ”€â”€ product.ts
â”‚   â””â”€â”€ customer.ts
â””â”€â”€ utils/
    â”œâ”€â”€ validation.ts
    â””â”€â”€ calculations.ts
```

### ğŸ¯ Estado de la AplicaciÃ³n (Zustand)
```typescript
interface OrderStore {
  // Estado
  activeOrders: Order[];
  currentOrderId: string | null;
  categories: ProductCategory[];
  products: Product[];
  customers: Customer[];
  banks: Bank[];
  apps: App[];
  
  // Acciones
  createOrder: (orderData: CreateOrderDto) => Promise<void>;
  updateOrder: (orderId: string, updates: Partial<Order>) => void;
  addProduct: (orderId: string, product: Product, quantity: number) => void;
  removeProduct: (orderId: string, productId: number) => void;
  updatePayment: (orderId: string, payments: PaymentData) => void;
  saveOrder: (orderId: string) => Promise<void>;
  cancelOrder: (orderId: string) => void;
  setCurrentOrder: (orderId: string) => void;
}
```

---

## âœ… VALIDACIONES Y REGLAS DE NEGOCIO

### ğŸš¨ Validaciones Obligatorias
1. **Delivery**: Cliente y direcciÃ³n obligatorios
2. **Reservation**: Fecha/hora de entrega obligatoria
3. **Pagos**: MÃ¡ximo 1 App Payment por pedido
4. **Totales**: Suma de pagos debe coincidir con total del pedido
5. **Productos**: Al menos 1 producto en el pedido

### ğŸ“Š CÃ¡lculos AutomÃ¡ticos
- Los subtotales y totales se calculan en el backend
- El frontend debe enviar los datos y recibir los totales calculados
- Mostrar loading mientras se calculan los totales

### ğŸ”„ Flujo de Trabajo
1. Usuario selecciona tipo de pedido
2. Si delivery: buscar/crear cliente
3. Si delivery: seleccionar/crear direcciÃ³n
4. Agregar productos al carrito
5. Configurar mÃ©todos de pago
6. Validar totales
7. Guardar pedido
8. Confirmar creaciÃ³n exitosa

---

## ğŸ¯ PRIORIDADES DE IMPLEMENTACIÃ“N

### **Fase 1: MVP BÃ¡sico** â­
1. âœ… Formulario bÃ¡sico de creaciÃ³n de pedidos
2. âœ… Selector de productos por categorÃ­as
3. âœ… Carrito de productos
4. âœ… Un mÃ©todo de pago (efectivo)
5. âœ… Guardado bÃ¡sico del pedido

### **Fase 2: Funcionalidades Completas** â­â­
1. âœ… GestiÃ³n de clientes y direcciones
2. âœ… MÃºltiples mÃ©todos de pago
3. âœ… Validaciones en tiempo real
4. âœ… Manejo de errores
5. âœ… UX optimizada

### **Fase 3: CaracterÃ­sticas Avanzadas** â­â­â­
1. âœ… MÃºltiples pedidos en paralelo (tabs)
2. âœ… Autoguardado
3. âœ… BÃºsqueda rÃ¡pida de productos
4. âœ… Atajos de teclado
5. âœ… EstadÃ­sticas en tiempo real

---

## ğŸš€ COMENZAR IMPLEMENTACIÃ“N

### ğŸ“‹ Pasos Iniciales
1. **Configurar proyecto** con React + TypeScript
2. **Instalar dependencias** (UI library, state management, etc.)
3. **Configurar API client** para comunicaciÃ³n con backend
4. **Crear tipos TypeScript** basados en los DTOs del backend
5. **Implementar store** para gestiÃ³n de estado
6. **Crear componentes bÃ¡sicos** de UI
7. **Implementar formulario** de creaciÃ³n de pedidos
8. **Conectar con API** y probar funcionalidad

### ğŸ¯ Objetivo Inmediato
**Crear un formulario funcional que permita:**
- Seleccionar tipo de pedido
- Agregar productos al carrito
- Configurar un mÃ©todo de pago bÃ¡sico
- Guardar el pedido en el backend
- Mostrar confirmaciÃ³n de Ã©xito

### ğŸ’¡ Consejos de ImplementaciÃ³n
1. **Prioriza la funcionalidad** sobre el diseÃ±o inicial
2. **Usa TypeScript** para evitar errores en tiempo de compilaciÃ³n
3. **Implementa validaciones** tanto en frontend como confÃ­a en backend
4. **Maneja estados de loading** para mejor UX
5. **Usa componentes reutilizables** para mantener cÃ³digo limpio
6. **Implementa manejo de errores** robusto
7. **Optimiza para dispositivos tÃ¡ctiles** (tablets)

---

## ğŸ“ SOPORTE Y RECURSOS

### ğŸ“š DocumentaciÃ³n Adicional
- Backend API: Swagger disponible en `/swagger`
- Tipos TypeScript: Definidos en los DTOs del backend
- AutenticaciÃ³n: JWT con roles especÃ­ficos

### ğŸ” Debugging
- Usar DevTools del navegador
- Revisar Network tab para requests a la API
- Verificar respuestas de error del backend
- Validar que los tipos TypeScript coincidan con los DTOs

### ğŸ¯ Criterios de Ã‰xito
- âœ… Usuario puede crear un pedido completo en menos de 2 minutos
- âœ… Interfaz intuitiva y rÃ¡pida de usar
- âœ… Validaciones claras y Ãºtiles
- âœ… Manejo robusto de errores
- âœ… Funciona correctamente en tablets
- âœ… CÃ³digo limpio y mantenible

**Â¡Comienza implementando el formulario bÃ¡sico de creaciÃ³n de pedidos y luego expande las funcionalidades paso a paso!** ğŸš€



